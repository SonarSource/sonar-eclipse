<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<plugin>

<!-- Extensions -->

  <extension point="org.eclipse.ui.preferencePages">
    <page
        class="org.sonarlint.eclipse.ui.internal.preferences.SonarLintPreferencePage"
        id="org.sonarlint.eclipse.ui.preferences.SonarPreferencePage"
        name="%sonar.preference.page.name">
        <keywordReference id="org.sonarlint.eclipse.ui.SonarLintKeyword"/>
    </page>
    <page
          category="org.sonarlint.eclipse.ui.preferences.SonarPreferencePage"
          class="org.sonarlint.eclipse.ui.internal.properties.SonarLintExtraArgumentsPreferenceAndPropertyPage"
          id="org.sonarlint.eclipse.ui.properties.SonarExtraArgumentsPreferenceAndPropertyPage"
          name="%sonar.preference.extraProps.page.name">
          <keywordReference id="org.sonarlint.eclipse.ui.SonarLintKeyword"/>
    </page>
  </extension>

  <extension
     point="org.eclipse.ui.keywords">
    <keyword
            label="sonar sonarqube sonarlint"
            id="org.sonarlint.eclipse.ui.SonarLintKeyword"/>
   </extension>

  <extension point="org.eclipse.ui.views">
    <category
        name="%sonar.category.view.name"
        id="org.sonarlint.eclipse">
    </category>
    <view
        category="org.sonarlint.eclipse"
        class="org.sonarlint.eclipse.ui.internal.views.issues.IssuesView"
        icon="icons/onde-sonar-16.png"
        id="org.sonarlint.eclipse.ui.views.issues.IssuesView"
        name="%sonar.issues.view.name">
    </view>
    <view
          category="org.sonarlint.eclipse"
          class="org.sonarlint.eclipse.ui.internal.views.RuleDescriptionWebView"
          icon="icons/onde-sonar-16.png"
          id="org.sonarlint.eclipse.ui.views.RuleDescriptionWebView"
          name="SonarLint Rule Description">
    </view>
  </extension>

  <extension
      point="org.eclipse.ui.ide.markerSupport">
    <markerContentGenerator
         id="org.sonarlint.eclipse.ui.views.issues.issueMarkerGenerator"
         name="SonarLint Issue Marker Generator">
        <markerTypeReference
              id="org.sonarlint.eclipse.core.sonarlintProblem"/>
        <markerFieldReference
              id="org.sonarlint.eclipse.ui.views.issues.issueCreationDateField"
              visible="true"/>
        <markerFieldReference
              id="org.sonarlint.eclipse.ui.views.issues.issueDescriptionField"
              visible="true"/>
        <markerFieldReference
              id="org.sonarlint.eclipse.ui.views.issues.issueRuleKeyField"
              visible="false"/>
        <markerFieldReference
              id="org.sonarlint.eclipse.ui.views.issues.issueRuleNameField"
              visible="false"/>
        <markerFieldReference
              id="org.eclipse.ui.ide.resourceField"
              visible="true"/>
        <markerFieldReference
              id="org.eclipse.ui.ide.pathField"
              visible="false"/>
        <!-- Default Filtering -->
        <markerFieldConfiguration
              enabled="true"
              id="org.sonarlint.eclipse.ui.issues.allIssuesOnSelectionFiltering"
              name="All Issues on Selection"
              scope="ON_SELECTED_AND_CHILDREN">
        </markerFieldConfiguration>

      <markerGrouping
            id="org.sonarlint.eclipse.ui.issues.severityGrouping"
            label="Severity">
         <markerGroupingEntry
               id="org.sonarlint.eclipse.ui.issues.severityGrouping.blocker"
               label="Blocker"
               markerGrouping="org.sonarlint.eclipse.ui.issues.severityGrouping"
               priority="5">
         </markerGroupingEntry>
         <markerGroupingEntry
               id="org.sonarlint.eclipse.ui.issues.severityGrouping.critical"
               label="Critical"
               markerGrouping="org.sonarlint.eclipse.ui.issues.severityGrouping"
               priority="4">
         </markerGroupingEntry>
         <markerGroupingEntry
               id="org.sonarlint.eclipse.ui.issues.severityGrouping.major"
               label="Major"
               markerGrouping="org.sonarlint.eclipse.ui.issues.severityGrouping"
               priority="3">
         </markerGroupingEntry>
         <markerGroupingEntry
               id="org.sonarlint.eclipse.ui.issues.severityGrouping.minor"
               label="Minor"
               markerGrouping="org.sonarlint.eclipse.ui.issues.severityGrouping"
               priority="2">
         </markerGroupingEntry>
         <markerGroupingEntry
               id="org.sonarlint.eclipse.ui.issues.severityGrouping.info"
               label="Info"
               markerGrouping="org.sonarlint.eclipse.ui.issues.severityGrouping"
               priority="1">
         </markerGroupingEntry>
         <markerAttributeGrouping
               attribute="sonarseverity"
               markerType="org.sonarlint.eclipse.core.sonarlintProblem">
            <markerAttributeMapping
                  markerGroupingEntry="org.sonarlint.eclipse.ui.issues.severityGrouping.blocker"
                  value="BLOCKER">
            </markerAttributeMapping>
            <markerAttributeMapping
                  markerGroupingEntry="org.sonarlint.eclipse.ui.issues.severityGrouping.critical"
                  value="CRITICAL">
            </markerAttributeMapping>
            <markerAttributeMapping
                  markerGroupingEntry="org.sonarlint.eclipse.ui.issues.severityGrouping.major"
                  value="MAJOR">
            </markerAttributeMapping>
            <markerAttributeMapping
                  markerGroupingEntry="org.sonarlint.eclipse.ui.issues.severityGrouping.minor"
                  value="MINOR">
            </markerAttributeMapping>
            <markerAttributeMapping
                  markerGroupingEntry="org.sonarlint.eclipse.ui.issues.severityGrouping.info"
                  value="INFO">
            </markerAttributeMapping>
         </markerAttributeGrouping>
      </markerGrouping>
    </markerContentGenerator>
    <markerField
        class="org.sonarlint.eclipse.ui.internal.views.issues.IssueDescriptionField"
        filterClass="org.eclipse.ui.internal.views.markers.DescriptionFieldFilter"
        filterConfigurationClass="org.eclipse.ui.internal.views.markers.DescriptionConfigurationArea"
        id="org.sonarlint.eclipse.ui.views.issues.issueDescriptionField"
        name="Description">
    </markerField>
    <markerField
        class="org.sonarlint.eclipse.ui.internal.views.issues.IssueRuleNameField"
        id="org.sonarlint.eclipse.ui.views.issues.issueRuleNameField"
        name="Rule name">
    </markerField>
    <markerField
        class="org.sonarlint.eclipse.ui.internal.views.issues.IssueRuleKeyField"
        id="org.sonarlint.eclipse.ui.views.issues.issueRuleKeyField"
        name="%sonar.issues.view.rulekeyfield">
    </markerField>
    <markerField
        class="org.sonarlint.eclipse.ui.internal.views.issues.CreationDateField"
        id="org.sonarlint.eclipse.ui.views.issues.issueCreationDateField"
        name="Date">
    </markerField>

    <markerTypeCategory
          name="SonarLint">
       <markerTypeReference id="org.sonarlint.eclipse.core.sonarlintProblem">
       </markerTypeReference>
    </markerTypeCategory>
  </extension>

  <extension
      point="org.eclipse.ui.propertyPages">
    <page
      class="org.sonarlint.eclipse.ui.internal.properties.SonarProjectPropertyPage"
       id="org.sonarlint.eclipse.ui.properties.sonarProjectPropertyPage"
       name="%sonar.properties.page.name">
       <filter name="projectNature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
       <enabledWhen>
          <adapt type="org.eclipse.core.resources.IProject"/>
       </enabledWhen>
    </page>
    <page
      class="org.sonarlint.eclipse.ui.internal.properties.SonarLintExtraArgumentsPreferenceAndPropertyPage"
       id="org.sonarlint.eclipse.ui.properties.SonarExtraArgumentsPreferenceAndPropertyPage"
       category="org.sonarlint.eclipse.ui.properties.sonarProjectPropertyPage"
       name="%sonar.preference.extraProps.page.name">
       <filter name="projectNature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
       <enabledWhen>
          <adapt type="org.eclipse.core.resources.IProject"/>
       </enabledWhen>
    </page>
  </extension>

  <extension point="org.eclipse.ui.popupMenus">
    <objectContribution id="org.sonarlint.eclipse.ui.projectContributions"
                        adaptable="true"
                        objectClass="org.eclipse.core.resources.IProject">
        <visibility>
           <objectState name="nature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
        </visibility>
        <action id="org.sonarlint.eclipse.addRemoveNatureAction"
              class="org.sonarlint.eclipse.ui.internal.actions.ToggleNatureAction"
              enablesFor="+"
              label="Disable SonarLint"
              menubarPath="sonar.menu/group3">
        </action>
    </objectContribution>
  </extension>

  <extension point="org.eclipse.ui.menus">
      <menuContribution
            locationURI="menu:org.sonarlint.eclipse.ui.views.issues.IssuesView">
         <menu
           id="org.eclipse.ui.ide.problems.filtersMenu"
           label="Show"
           mnemonic="S">
         </menu>
     <menu
           id="problemsGroupByMenu"
           label="Group By"
           mnemonic="G">
         </menu>
         <menu
               id="org.eclipse.ui.ide.problems.markerSortMenu"
               label="Sort By"
               mnemonic="S">
         </menu>
         <command
               commandId="org.eclipse.ui.ide.configureFilters"
               mnemonic="%command.configureFilters.mnemonic"
               style="push">
         </command>
         <command
               commandId="org.eclipse.ui.ide.configureColumns"
               mnemonic="%command.configureColumns.mnemonic"
               style="push">
         </command>
      </menuContribution>
      <menuContribution
            locationURI="popup:org.sonarlint.eclipse.ui.views.issues.IssuesView">
           <command
                 commandId="org.sonarlint.eclipse.ui.internal.command.ShowRuleDescriptionCommand"
                 style="push"
                 mnemonic="R">
         </command>
      </menuContribution>
      <menuContribution
            locationURI="popup:org.sonarlint.eclipse.ui.views.issues.IssuesView">
           <command
                 commandId="org.eclipse.jdt.ui.edit.text.java.correction.assist.proposals"
                 style="push"
                 mnemonic="%command.correctionAssistProposals.mnemonic">
         </command>
      </menuContribution>
     <menuContribution locationURI="popup:org.eclipse.ui.projectConfigure?after=additions">
       <command
             commandId="org.sonarlint.eclipse.ui.command.EnableSonarLintCommand"
             style="push">
          <visibleWhen>
              <with variable="activeMenuSelection">
                 <iterate ifEmpty="false">
                   <or>
                     <adapt type="org.eclipse.core.resources.IProject">
                       <not>
                          <test property="org.eclipse.core.resources.projectNature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
                       </not>
                     </adapt>
                     <adapt type="org.eclipse.ui.IWorkingSet" />
                   </or>
                 </iterate>
             </with>
          </visibleWhen>
       </command>
    </menuContribution>
    <menuContribution locationURI="popup:sonar.menu?after=group1">
       <command
             commandId="org.sonarlint.eclipse.ui.internal.command.AnalyzeProjectsCommand"
             style="push">
          <visibleWhen>
             <with variable="activeMenuSelection">
                <iterate ifEmpty="false">
                  <or>
                    <adapt type="org.eclipse.core.resources.IProject">
                      <test property="org.eclipse.core.resources.projectNature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
                    </adapt>
                    <adapt type="org.eclipse.ui.IWorkingSet" />
                  </or>
                </iterate>
             </with>
          </visibleWhen>
       </command>
    </menuContribution>
  </extension>

  <extension point="org.eclipse.ui.commands">
    <category
          description="SonarLint commands"
          id="org.sonarlint.eclipse.ui.command.category"
          name="SonarLint">
    </category>
    <command
          description="Enable SonarLint"
          id="org.sonarlint.eclipse.ui.command.EnableSonarLintCommand"
          name="Enable SonarLint"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Open SonarQube association wizard"
          id="org.sonarlint.eclipse.ui.command.ConfigureProjectsCommand"
          name="Associate with SonarQube Server..."
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Open SonarQube association wizard"
          id="org.sonarlint.eclipse.ui.internal.command.ReConfigureProjectsCommand"
          name="Change Project Association..."
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Remove project association with a remote server"
          id="org.sonarlint.eclipse.ui.internal.command.RemoveAssociationProjectsCommand"
          name="Remove Project Association"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Show rule details"
          id="org.sonarlint.eclipse.ui.internal.command.ShowRuleDescriptionCommand"
          name="Rule description"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Analyze project with SonarQube"
          id="org.sonarlint.eclipse.ui.internal.command.AnalyzeProjectsCommand"
          name="Analyze all files"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>
    <command
          description="Reload caches from server"
          id="org.sonarlint.eclipse.ui.internal.command.SyncProjectsCommand"
          name="Sync with server"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>    
    <command
          description="Update SonarLint rules and configuration"
          id="org.sonarlint.eclipse.ui.internal.command.UpdateCommand"
          name="Update SonarLint"
          categoryId="org.sonarlint.eclipse.ui.command.category">
    </command>    
  </extension>

  <extension point="org.eclipse.ui.handlers">
    <handler
          class="org.sonarlint.eclipse.ui.internal.command.EnableSonarQubeNatureCommand"
          commandId="org.sonarlint.eclipse.ui.command.EnableSonarLintCommand">
    </handler>
    <handler
          class="org.sonarlint.eclipse.ui.internal.command.ShowRuleDescriptionCommand"
          commandId="org.sonarlint.eclipse.ui.internal.command.ShowRuleDescriptionCommand">
    </handler>
    <handler
          class="org.sonarlint.eclipse.ui.internal.command.AnalyzeProjectsCommand"
          commandId="org.sonarlint.eclipse.ui.internal.command.AnalyzeProjectsCommand">
    </handler>
    <handler
          class="org.sonarlint.eclipse.ui.internal.command.UpdateCommand"
          commandId="org.sonarlint.eclipse.ui.internal.command.UpdateCommand">
    </handler>
    <handler
          class="org.eclipse.ui.internal.views.markers.QuickFixHandler"
          commandId="org.eclipse.jdt.ui.edit.text.java.correction.assist.proposals">
    </handler>
  </extension>

  <extension point="org.eclipse.ui.commandImages">
    <image
      commandId="org.sonarlint.eclipse.ui.command.EnableSonarLintCommand"
      icon="icons/onde-sonar-16.png" />
    <image
      commandId="org.sonarlint.eclipse.ui.internal.command.AnalyzeProjectsCommand"
      icon="icons/inspect.png" />
  </extension>

   <extension
        point="org.eclipse.ui.editors.annotationTypes">
        <type
            name="org.sonarlint.eclipse.issueAnnotationType"
            markerType="org.sonarlint.eclipse.core.sonarlintProblem"/>
    </extension>

    <extension
        point="org.eclipse.ui.editors.markerAnnotationSpecification">
        <specification
              annotationImageProvider="org.sonarlint.eclipse.ui.internal.markers.SonarLintMarkerImageProvider"
              annotationType="org.sonarlint.eclipse.issueAnnotationType"
              colorPreferenceKey="org.sonarlint.eclipse.ui.issue.color"
              colorPreferenceValue="30,144,255"
              highlightPreferenceKey="org.sonarlint.eclipse.ui.issue.highlight"
              highlightPreferenceValue="false"
              icon="icons/onde-sonar-16.png"
              isGoToNextNavigationTarget="true"
              isGoToNextNavigationTargetKey="org.sonarlint.eclipse.issue.next"
              isGoToPreviousNavigationTarget="true"
              isGoToPreviousNavigationTargetKey="org.sonarlint.eclipse.issue.previous"
              label="%sonar.marker.specification.label"
              overviewRulerPreferenceKey="org.sonarlint.eclipse.ui.issue.overviewruler"
              overviewRulerPreferenceValue="true"
              presentationLayer="3"
              showInNextPrevDropdownToolbarAction="true"
              showInNextPrevDropdownToolbarActionKey="org.sonarlint.eclipse.issue.dropdown"
              textPreferenceKey="org.sonarlint.eclipse.ui.issue.error.text"
              textPreferenceValue="true"
              textStylePreferenceKey="org.sonarlint.eclipse.ui.issue.text.style"
              textStylePreferenceValue="SQUIGGLES"
              verticalRulerPreferenceKey="org.sonarlint.eclipse.ui.issue.verticalruler"
              verticalRulerPreferenceValue="true"/>
  </extension>

  <extension
        point="org.eclipse.ui.console.consoleFactories">
     <consoleFactory
           class="org.sonarlint.eclipse.ui.internal.console.SonarLintConsoleFactory"
           icon="icons/onde-sonar-16.png"
           label="%consoleFactory.label">
     </consoleFactory>
  </extension>

  <extension
        point="org.eclipse.ui.console.consolePageParticipants">
     <consolePageParticipant
           class="org.sonarlint.eclipse.ui.internal.console.SonarLintConsolePageParticipant"
           id="org.sonarlint.eclipse.ui.consolePageParticipant1">
        <enablement>
           <instanceof value="org.sonarlint.eclipse.ui.internal.console.SonarLintConsole" />
        </enablement>
     </consolePageParticipant>
  </extension>
  <extension
        point="org.eclipse.ui.menus">
     <menuContribution
           locationURI="popup:org.eclipse.ui.popup.any?after=additions">
        <menu
              icon="icons/onde-sonar-16.png"
              id="sonar.menu"
              label="%sonar.menu.label">
           <separator
                 name="group1">
           </separator>
           <menu
                 id="mode"
                 label="Mode">
              <separator
                    name="group1">
              </separator>
           </menu>
           <separator
                 name="group2">
           </separator>
           <separator
                 name="group3"
                 visible="true">
           </separator>
        </menu>
     </menuContribution>
     <menuContribution
            locationURI="menu:help?after=org.eclipse.equinox.p2.ui.sdk.update">
         <command
               commandId="org.sonarlint.eclipse.ui.internal.command.UpdateCommand"
               icon="icons/onde-sonar-16.png"
               label="Update SonarLint"
               style="push">
         </command>
      </menuContribution>
  </extension>

  <!-- Label decorator -->
  <extension point="org.eclipse.ui.decorators">
     <decorator
           adaptable="true"
           icon="icons/sonar-label-decorator.gif"
           id="org.sonarlint.eclipse.ui.sonarlintDecorator"
           label="%sonar.decorator.name"
           lightweight="true"
           location="TOP_RIGHT"
           state="true">
       <description>%sonar.decorator.description</description>
       <enablement>
         <objectState name="nature" value="org.sonarlint.eclipse.core.sonarlintNature"/>
       </enablement>
     </decorator>

  </extension>
  
  <!-- Marker resolver -->
  <extension
        point="org.eclipse.ui.ide.markerResolution">
     <markerResolutionGenerator
           class="org.sonarlint.eclipse.ui.internal.resolver.MarkerResolutionGenerator"
           markerType="org.sonarlint.eclipse.core.sonarlintProblem">
     </markerResolutionGenerator>
  </extension>
</plugin>
